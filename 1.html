<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚‚ãã‚‰å©ãï¼ˆå…±é€šJSç‰ˆï¼‰</title>
    <style>
        /* (CSSã¯å¤‰æ›´ãªã—ãªã®ã§çœç•¥ã—ã¾ã™ã€‚ãã®ã¾ã¾æ®‹ã—ã¦ãã ã•ã„) */
        body { font-family: sans-serif; text-align: center; background-color: #f0f8ff; user-select: none; margin: 0; padding-bottom: 50px; }
        h1 { margin: 15px 0; color: #333; }
        .game-grid { width: 320px; margin: 0 auto; display: flex; flex-wrap: wrap; gap: 10px; }
        .hole { flex: 1 0 30%; height: 100px; background-color: #8d6e63; border-radius: 50%; position: relative; overflow: hidden; border: 4px solid #5d4037; }
        .mole { width: 100%; height: 100%; position: absolute; top: 100%; left: 0; background-color: #fff3e0; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 60px; transition: top 0.1s; pointer-events: none; }
        .hole.up .mole { top: 0; }
        /* ...ãã®ä»–ã®CSS... */
        .status-board { font-size: 20px; font-weight: bold; margin: 10px; display: flex; justify-content: center; gap: 20px; }
        #start-btn { font-size: 22px; padding: 10px 30px; background-color: #4CAF50; color: white; border: none; border-radius: 50px; cursor: pointer; margin-bottom:10px; }
        #result-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); justify-content: center; align-items: center; z-index: 999; }
        .result-box { background: white; padding: 20px; border-radius: 20px; text-align: center; width: 85%; max-width: 400px; }
        .back-link { display: block; margin-top: 20px; color: #666; text-decoration: none; }
    </style>
</head>
<body>
    <h1>ğŸ¹ ã‚‚ãã‚‰å©ã ğŸ¹</h1>
    <div class="status-board">
        <div>å¾—ç‚¹: <span id="score">0</span></div>
        <div>æ®‹ã‚Š: <span id="timer">15</span>ç§’</div>
    </div>
    <button id="start-btn">ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>

    <div class="game-grid">
        <div class="hole"><div class="mole">ğŸ¹</div></div>
        <div class="hole"><div class="mole">ğŸ¹</div></div>
        <div class="hole"><div class="mole">ğŸ¹</div></div>
        <div class="hole"><div class="mole">ğŸ¹</div></div>
        <div class="hole"><div class="mole">ğŸ¹</div></div>
        <div class="hole"><div class="mole">ğŸ¹</div></div>
        <div class="hole"><div class="mole">ğŸ¹</div></div>
        <div class="hole"><div class="mole">ğŸ¹</div></div>
        <div class="hole"><div class="mole">ğŸ¹</div></div>
    </div>
    <a href="index.html" class="back-link">ğŸ  ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</a>

    <div id="result-overlay">
        <div class="result-box">
            <h2>çµ‚äº†ï¼</h2>
            <div style="font-size:32px; color:red; font-weight:bold;" id="final-score">0ç‚¹</div>
            <div id="sending-msg" style="font-size:12px; color:blue;"></div>
            <br>
            <button onclick="location.reload()" style="background:#2196F3; color:white; border:none; padding:10px 30px; border-radius:30px;">ã‚‚ã†ä¸€å›</button>
            <br>
            <a href="index.html" class="back-link">ğŸ  ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</a>
        </div>
    </div>

    <script src="common.js"></script>

    <script>
        window.onload = function() {
            // è¦ç´ å–å¾—
            const holes = document.querySelectorAll('.hole');
            const scoreBoard = document.getElementById('score');
            const timerBoard = document.getElementById('timer');
            const startBtn = document.getElementById('start-btn');
            const resultOverlay = document.getElementById('result-overlay');
            const finalScore = document.getElementById('final-score');
            
            let lastHole;
            let timeUp = false;
            let score = 0;
            let countdown;
            let timeLeft = 15;
            
            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼
            const STORAGE_KEY = 'mogura_ranking_v2';

            // â˜…é–¢æ•°ï¼šã‚¹ã‚³ã‚¢ä¿å­˜ï¼†é€ä¿¡
            function saveScore(newScore) {
                // 1. Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¸é€ä¿¡ (common.jsã®é–¢æ•°)
                // ã‚‚ã—common.jsãŒãªã„å ´åˆã®ã‚¨ãƒ©ãƒ¼ã‚’é˜²ããƒã‚§ãƒƒã‚¯
                if (typeof sendData === 'function') {
                    document.getElementById('sending-msg').textContent = "è¨˜éŒ²ä¸­...";
                    sendData("ã‚‚ãã‚‰å©ã", newScore);
                    setTimeout(() => { document.getElementById('sending-msg').textContent = "âœ… è¨˜éŒ²å®Œäº†"; }, 1000);
                } else {
                    console.log("common.jsãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
                }

                // 2. ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼‰ã¸ä¿å­˜
                let saved = localStorage.getItem(STORAGE_KEY);
                let scores = saved ? JSON.parse(saved) : [];
                scores.push(newScore);
                scores.sort((a, b) => b - a);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(scores.slice(0, 5)));
            }

            // --- ä»¥ä¸‹ã€ã„ã¤ã‚‚ã®ã‚²ãƒ¼ãƒ å‡¦ç† ---
            function randomTime(min, max) { return Math.round(Math.random() * (max - min) + min); }
            function randomHole(holes) {
                const idx = Math.floor(Math.random() * holes.length);
                const hole = holes[idx];
                if (hole === lastHole) return randomHole(holes);
                lastHole = hole;
                return hole;
            }
            function peep() {
                const time = randomTime(600, 1200);
                const hole = randomHole(holes);
                hole.classList.add('up');
                setTimeout(() => {
                    hole.classList.remove('up');
                    if (!timeUp) peep();
                }, time);
            }
            function startGame() {
                scoreBoard.textContent = 0;
                timerBoard.textContent = 15;
                score = 0;
                timeLeft = 15;
                timeUp = false;
                startBtn.disabled = true;
                peep();
                countdown = setInterval(() => {
                    timeLeft--;
                    timerBoard.textContent = timeLeft;
                    if (timeLeft <= 0) {
                        clearInterval(countdown);
                        timeUp = true;
                        
                        // ã‚²ãƒ¼ãƒ çµ‚äº†æ™‚ã«ä¿å­˜å‡¦ç†ã‚’å‘¼ã¶
                        saveScore(score);
                        
                        finalScore.textContent = score + "ç‚¹";
                        resultOverlay.style.display = "flex";
                        startBtn.disabled = false;
                    }
                }, 1000);
            }
            function bonk(e) {
                if(!e.isTrusted) return;
                const hole = this;
                if(!hole.classList.contains('up')) return;
                score++;
                hole.classList.remove('up');
                scoreBoard.textContent = score;
            }
            holes.forEach(hole => hole.addEventListener('click', bonk));
            startBtn.addEventListener('click', startGame);
        };
    </script>
</body>
</html>